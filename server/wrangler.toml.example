# Wrangler 配置文件模板
# 复制此文件为 wrangler.toml 并填入实际值
# 获取配置值请参考: .github/DEPLOYMENT_CONFIG.md

name = "rmm-server"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# 生产环境配置
[env.production]
name = "rmm-server-prod"
vars = { ENVIRONMENT = "production" }

# 测试环境配置
[env.test]
name = "rmm-server-test"
vars = { ENVIRONMENT = "test" }

# D1 数据库配置
[[d1_databases]]
binding = "DB"
database_name = "rmm-db-local"
database_id = "your-d1-database-id"           # 运行 wrangler d1 list 获取
preview_database_id = "your-preview-db-id"    # 预览环境数据库 ID

[[env.production.d1_databases]]
binding = "DB"
database_name = "rmm-db-prod"
database_id = "your-prod-d1-database-id"      # 生产环境 D1 数据库 ID

[[env.test.d1_databases]]
binding = "DB"
database_name = "rmm-db-test"
database_id = "your-test-d1-database-id"      # 测试环境 D1 数据库 ID

# KV 存储配置 (本地开发)
[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id"                   # 运行 wrangler kv namespace list 获取
preview_id = "your-preview-kv-id"             # 预览环境 KV ID

[[env.production.kv_namespaces]]
binding = "KV"
id = "your-prod-kv-namespace-id"              # 生产环境 KV namespace ID

[[env.test.kv_namespaces]]
binding = "KV"
id = "your-test-kv-namespace-id"              # 测试环境 KV namespace ID

# R2 对象存储配置
[[r2_buckets]]
binding = "R2"
bucket_name = "rmm-files-dev"                 # 运行 wrangler r2 bucket list 获取
preview_bucket_name = "rmm-files-dev"

[env.production.r2_buckets]
binding = "R2"
bucket_name = "rmm-files-prod"

[env.test.r2_buckets]
binding = "R2"
bucket_name = "rmm-files-test"

# Durable Objects 配置
[[durable_objects.bindings]]
name = "SESSION_DO"
class_name = "SessionDurableObject"

# Durable Objects 迁移
[[migrations]]
tag = "v1"
new_classes = [ "SessionDurableObject" ]

# 环境变量
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"
MAX_FILE_SIZE = "10485760"  # 10MB
SESSION_TIMEOUT = "1800"    # 30 minutes
HEARTBEAT_INTERVAL = "60"   # 60 seconds
NONCE_WINDOW = "300"        # 5 minutes

# Secrets (通过 wrangler secret put 命令设置)
# wrangler secret put JWT_SECRET
# wrangler secret put ENCRYPTION_KEY
# wrangler secret put ADMIN_PASSWORD
# wrangler secret put ENROLLMENT_SECRET
# wrangler secret put WEBHOOK_SECRET
