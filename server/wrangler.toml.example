# Wrangler é…ç½®æ–‡ä»¶æ¨¡æ¿
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º wrangler.toml å¹¶å¡«å…¥å®é™…å€?
# è·å–é…ç½®å€¼è¯·å‚è€? .github/DEPLOYMENT_CONFIG.md

name = "ruinos-server"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# ç”Ÿäº§ç¯å¢ƒé…ç½®
[env.production]
name = "ruinos-server-prod"
vars = { ENVIRONMENT = "production" }

# æµ‹è¯•ç¯å¢ƒé…ç½®
[env.test]
name = "ruinos-server-test"
vars = { ENVIRONMENT = "test" }

# D1 æ•°æ®åº“é…ç½?
[[d1_databases]]
binding = "DB"
database_name = "ruinos-db-local"
database_id = "your-d1-database-id"           # è¿è¡Œ wrangler d1 list è·å–
preview_database_id = "your-preview-db-id"    # é¢„è§ˆç¯å¢ƒæ•°æ®åº?ID

[[env.production.d1_databases]]
binding = "DB"
database_name = "ruinos-db-prod"
database_id = "your-prod-d1-database-id"      # ç”Ÿäº§ç¯å¢ƒ D1 æ•°æ®åº?ID

[[env.test.d1_databases]]
binding = "DB"
database_name = "ruinos-db-test"
database_id = "your-test-d1-database-id"      # æµ‹è¯•ç¯å¢ƒ D1 æ•°æ®åº?ID

# KV å­˜å‚¨é…ç½® (æœ¬åœ°å¼€å?
[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id"                   # è¿è¡Œ wrangler kv namespace list è·å–
preview_id = "your-preview-kv-id"             # é¢„è§ˆç¯å¢ƒ KV ID

[[env.production.kv_namespaces]]
binding = "KV"
id = "your-prod-kv-namespace-id"              # ç”Ÿäº§ç¯å¢ƒ KV namespace ID

[[env.test.kv_namespaces]]
binding = "KV"
id = "your-test-kv-namespace-id"              # æµ‹è¯•ç¯å¢ƒ KV namespace ID

# R2 å¯¹è±¡å­˜å‚¨é…ç½®
[[r2_buckets]]
binding = "R2"
bucket_name = "ruinos-files-dev"                 # è¿è¡Œ wrangler r2 bucket list è·å–
preview_bucket_name = "ruinos-files-dev"

[env.production.r2_buckets]
binding = "R2"
bucket_name = "ruinos-files-prod"

[env.test.r2_buckets]
binding = "R2"
bucket_name = "ruinos-files-test"

# Durable Objects é…ç½®
[[durable_objects.bindings]]
name = "SESSION_DO"
class_name = "SessionDurableObject"

# Durable Objects è¿ç§»
[[migrations]]
tag = "v1"
new_classes = [ "SessionDurableObject" ]

# ç¯å¢ƒå˜é‡
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"
MAX_FILE_SIZE = "10485760"  # 10MB
SESSION_TIMEOUT = "1800"    # 30 minutes
HEARTBEAT_INTERVAL = "60"   # 60 seconds
NONCE_WINDOW = "300"        # 5 minutes

# Secrets (é€šè¿‡ wrangler secret put å‘½ä»¤è®¾ç½®)
# wrangler secret put JWT_SECRET
# wrangler secret put ENCRYPTION_KEY
# wrangler secret put ADMIN_PASSWORD
# wrangler secret put ENROLLMENT_SECRET
# wrangler secret put WEBHOOK_SECRET
